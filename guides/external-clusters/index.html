
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Learn more about the CAST AI agent, connecting external clusters to CAST AI, and getting help if you need to do some troubleshooting.">
      
      
      
        <link rel="canonical" href="https://docs.cast.ai/guides/external-clusters/">
      
      <link rel="icon" href="../../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.2">
    
    
      
        <title>External cluster troubleshooting - CAST AI Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.f7951f6f.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.e6a45f82.min.css">
        
          
          
          <meta name="theme-color" content="#ffffff">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nimbus+Sans:300,400,400i,700%7C&display=fallback">
        <style>:root{--md-text-font:"Nimbus Sans";--md-code-font:""}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  


  <script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-162225268-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),"undefined"!=typeof location$&&location$.subscribe(function(e){ga("send","pageview",e.pathname)})})</script>
  <script async src="https://www.google-analytics.com/analytics.js"></script>


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="white" data-md-color-accent="indigo">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#external-cluster-troubleshooting" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="https://cast.ai/" title="CAST AI Documentation" class="md-header__button md-logo" aria-label="CAST AI Documentation" data-md-component="logo">
      <img src="../../img/cast-logo-dark-blue.svg" alt="Cast logo" style="width: 5em;" />
    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CAST AI Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              External cluster troubleshooting
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://cast.ai/" title="CAST AI Documentation" class="md-nav__button md-logo" aria-label="CAST AI Documentation" data-md-component="logo">
      <img src="../../img/cast-logo-dark-blue.svg" alt="Cast logo" style="width: 5em;" />
    </a>
    CAST AI Documentation
  </label>
  
    <div class="md-nav__source">
      
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Introduction
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2">
          Getting started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Getting started" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Getting started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2" type="checkbox" id="__nav_2_2" >
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2_2">
          AWS EKS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="AWS EKS" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          AWS EKS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/eks/eks/" class="md-nav__link">
        Connect and onboard EKS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/eks/remove-from-eks/" class="md-nav__link">
        Remove CAST AI from EKS
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_3" type="checkbox" id="__nav_2_3" >
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2_3">
          GCP GKE
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="GCP GKE" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          GCP GKE
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/gke/gke/" class="md-nav__link">
        Connect and onboard GKE
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/gke/remove-from-gke/" class="md-nav__link">
        Remove CAST AI from GKE
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/gke/gcp-marketplace-onboarding/" class="md-nav__link">
        Onboard Organization using GCP Marketplace
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_4" type="checkbox" id="__nav_2_4" >
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2_4">
          Azure AKS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Azure AKS" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_4">
          <span class="md-nav__icon md-icon"></span>
          Azure AKS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/aks/aks/" class="md-nav__link">
        Connect and onboard AKS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/aks/remove-from-aks/" class="md-nav__link">
        Remove CAST AI from AKS
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_5" type="checkbox" id="__nav_2_5" >
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2_5">
          kOps
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="kOps" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_5">
          <span class="md-nav__icon md-icon"></span>
          kOps
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/kops/kops/" class="md-nav__link">
        Connect and onboard kOps
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/kops/remove-from-kops/" class="md-nav__link">
        Remove CAST AI from kOps
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3">
          Product overview
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Product overview" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Product overview
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1" type="checkbox" id="__nav_3_1" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_1">
          Console
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Console" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          Console
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../product-overview/console/clusters/" class="md-nav__link">
        Clusters
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../product-overview/console/nodes/" class="md-nav__link">
        Nodes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../product-overview/console/audit-log/" class="md-nav__link">
        Audit Log
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../product-overview/console/autoscaler/" class="md-nav__link">
        Autoscaler
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../product-overview/console/cost-report/" class="md-nav__link">
        Cost report
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../product-overview/console/logs/" class="md-nav__link">
        Logs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../product-overview/console/api/" class="md-nav__link">
        API Access Keys
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../product-overview/console/security-insights/" class="md-nav__link">
        Security Report
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2" type="checkbox" id="__nav_3_2" >
      
      
      
        
          
            
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../product-overview/autoscaler/">Autoscaler</a>
          
            <label for="__nav_3_2">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Autoscaler" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          Autoscaler
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../product-overview/autoscaler/features/subnets/" class="md-nav__link">
        Subnets selection
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3" type="checkbox" id="__nav_3_3" >
      
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../product-overview/rebalancing/">Rebalancing</a>
          
            <label for="__nav_3_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Rebalancing" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          Rebalancing
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../product-overview/rebalancing/preparation/" class="md-nav__link">
        Preparation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../product-overview/rebalancing/run/" class="md-nav__link">
        Rebalance your cluster
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../product-overview/hosted-components/" class="md-nav__link">
        Hosted Components
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../product-overview/security/" class="md-nav__link">
        Security Report
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4">
          Guides
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Guides" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Guides
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          External cluster troubleshooting
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        External cluster troubleshooting
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#your-cluster-does-not-appear-in-the-connect-cluster-screen" class="md-nav__link">
    Your cluster does not appear in the Connect Cluster screen
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spot-nodes-are-displayed-as-on-demand-in-your-clusters-available-savings-page" class="md-nav__link">
    Spot nodes are displayed as On-demand in your cluster's Available Savings page
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tls-handshake-timeout-issue" class="md-nav__link">
    TLS handshake timeout issue
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#refused-connection-to-control-plane" class="md-nav__link">
    Refused connection to control plane
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#disconnected-or-not-responding-cluster" class="md-nav__link">
    Disconnected or Not responding cluster
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#upgrading-the-agent" class="md-nav__link">
    Upgrading the agent
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deleted-agent" class="md-nav__link">
    Deleted agent
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster-controller-is-receiving-forbidden-access" class="md-nav__link">
    Cluster-controller is receiving forbidden access
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aks-fail-to-pull-images-from-azure-container-registry-to-azure-kubernetes-service-cluster" class="md-nav__link">
    AKS Fail to pull images from Azure Container Registry to Azure Kubernetes Service cluster
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../pod-placement/" class="md-nav__link">
        Pod placement
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../volumes/" class="md-nav__link">
        Dynamic volume provisioning
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../connect-to-node/" class="md-nav__link">
        Connect to node
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../autoscaling-policies/" class="md-nav__link">
        Autoscaling policies
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../start-saving-quickly/" class="md-nav__link">
        Start saving quickly
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../hpa/" class="md-nav__link">
        Horizontal Pod Autoscaler
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../spot/" class="md-nav__link">
        Spot/Preemptible Instances
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../vpa/" class="md-nav__link">
        Right Sizing recommendations with VPA
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../gpu/" class="md-nav__link">
        GPU instances autoscaling
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../node-kernel-tuning/" class="md-nav__link">
        Node kernel tuning
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../evictor/" class="md-nav__link">
        Evictor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cluster-controller/" class="md-nav__link">
        Cluster controller
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kvisor-security/" class="md-nav__link">
        Kvisor security
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../node-configuration/" class="md-nav__link">
        Node Configuration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mutating-admision-webhook/" class="md-nav__link">
        Mutating Admission Webhook
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../metrics/" class="md-nav__link">
        Cluster metrics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../agent-monitoring/" class="md-nav__link">
        Agent status monitoring
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes-permissions/" class="md-nav__link">
        Kubernetes permissions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cloud-permissions/" class="md-nav__link">
        Cloud permissions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../custom-secret-management/" class="md-nav__link">
        Custom secret management
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../webhooks/" class="md-nav__link">
        How to setup Notification Webhooks
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5">
          API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="API" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api/overview/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api/authentication/" class="md-nav__link">
        Authentication
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api/specification/" class="md-nav__link">
        Specification
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api/terraform-provider/" class="md-nav__link">
        Terraform provider
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api/cli/" class="md-nav__link">
        CLI
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6">
          Administration
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Administration" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Administration
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../administration/configure-payment-method/" class="md-nav__link">
        Configure payment details
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="https://cast.ai/release-notes/" class="md-nav__link">
        Release notes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="https://status.cast.ai/" class="md-nav__link">
        Service status
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/castai" class="md-nav__link">
        CAST AI GitHub
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="https://join.slack.com/t/castai-community/shared_invite/zt-nwtbsbqq-dWOBiUgLtIGMsUSup7Xksw" class="md-nav__link">
        CAST AI Community Slack
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="https://console.cast.ai" class="md-nav__link">
        CAST AI Console
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="https://castai.medium.com/" class="md-nav__link">
        CAST AI on Medium
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="https://twitter.com/cast_ai" class="md-nav__link">
        CAST AI Twitter
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#your-cluster-does-not-appear-in-the-connect-cluster-screen" class="md-nav__link">
    Your cluster does not appear in the Connect Cluster screen
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spot-nodes-are-displayed-as-on-demand-in-your-clusters-available-savings-page" class="md-nav__link">
    Spot nodes are displayed as On-demand in your cluster's Available Savings page
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tls-handshake-timeout-issue" class="md-nav__link">
    TLS handshake timeout issue
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#refused-connection-to-control-plane" class="md-nav__link">
    Refused connection to control plane
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#disconnected-or-not-responding-cluster" class="md-nav__link">
    Disconnected or Not responding cluster
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#upgrading-the-agent" class="md-nav__link">
    Upgrading the agent
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deleted-agent" class="md-nav__link">
    Deleted agent
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster-controller-is-receiving-forbidden-access" class="md-nav__link">
    Cluster-controller is receiving forbidden access
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aks-fail-to-pull-images-from-azure-container-registry-to-azure-kubernetes-service-cluster" class="md-nav__link">
    AKS Fail to pull images from Azure Container Registry to Azure Kubernetes Service cluster
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
<a href="https://github.com/castai/docs/edit/main/docs/guides/external-clusters.md" title="Edit this page" class="md-content__button md-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
</a>


<h1 id="external-cluster-troubleshooting">External cluster troubleshooting<a class="headerlink" href="#external-cluster-troubleshooting" title="Permanent link">&para;</a></h1>
<p>This guide is intended for users who are experiencing issues while connecting their EKS, GCP, or AKS clusters to CAST AI. Once the cluster is connected, you can check the <code>Status</code> field in the <strong>Clusters overview</strong> screen to understand if cluster is operating as expected.</p>
<p><img alt="" src="cluster-dashboard.png" /></p>
<p>Further sections will cover the most common issues and how to resolve them.</p>
<h2 id="your-cluster-does-not-appear-in-the-connect-cluster-screen">Your cluster does not appear in the Connect Cluster screen<a class="headerlink" href="#your-cluster-does-not-appear-in-the-connect-cluster-screen" title="Permanent link">&para;</a></h2>
<p>If a cluster does not appear in the Connect your cluster screen after you've run the connection script, perform following steps.</p>
<ol>
<li>
<p>Check agent container logs:</p>
<div class="highlight"><pre><span></span><code>kubectl logs -n castai-agent -l app.kubernetes.io/name<span class="o">=</span>castai-agent -c agent
</code></pre></div>
</li>
<li>
<p>You might get output similar to this:</p>
<div class="highlight"><pre><span></span><code>time=&quot;2021-05-06T14:24:03Z&quot; level=fatal msg=&quot;agent failed: registering cluster: getting cluster name: describing instance_id=i-026b5fadab5b69d67: UnauthorizedOperation: You are not authorized to perform this operation.\n\tstatus code: 403, request id: 2165c357-b4a6-4f30-9266-a51f4aaa7ce7&quot;
</code></pre></div>
<p>or</p>
<div class="highlight"><pre><span></span><code>time=&quot;2021-05-06T14:24:03Z&quot; level=fatal msg=agent failed: getting provider: configuring aws client: NoCredentialProviders: no valid providers in chain&quot;
</code></pre></div>
</li>
</ol>
<p>These errors indicate that the CAST AI Agent failed to connect to the AWS API either because the nodes and/or workloads running in your cluster have custom constrained IAM permissions or the IAM roles are removed entirely. However, the CAST AI Agent requires read-only access to the AWS EC2 API to correctly identify some properties of your EKS cluster. Access to the AWS EC2 Metadata endpoint is optional, but the variables discovered from the endpoint must then be provided. The CAST AI Agent uses the official AWS SDK, so all variables to customize your authentication mentioned in its <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-envvars.html">documentation</a> are supported.</p>
<p>Provide cluster metadata by adding these environment variables to the CAST AI Agent deployment:</p>
<div class="highlight"><pre><span></span><code>            - name: EKS_ACCOUNT_ID
              value: &quot;000000000000&quot;    # your aws account id
            - name: EKS_REGION
              value: &quot;eu-central-1&quot;    # your eks cluster region
            - name: EKS_CLUSTER_NAME
              value: &quot;staging-example&quot; # your eks cluster name
</code></pre></div>
<h2 id="spot-nodes-are-displayed-as-on-demand-in-your-clusters-available-savings-page">Spot nodes are displayed as On-demand in your cluster's Available Savings page<a class="headerlink" href="#spot-nodes-are-displayed-as-on-demand-in-your-clusters-available-savings-page" title="Permanent link">&para;</a></h2>
<p>The CAST AI agent requires read-only permissions, so the default <code>AmazonEC2ReadOnlyAccess</code> is enough. Provide AWS API access by adding these variables to the CAST AI Agent secret:</p>
<div class="highlight"><pre><span></span><code>AWS_ACCESS_KEY_ID = xxxxxxxxxxxxxxxxxxxx
AWS_SECRET_ACCESS_KEY = xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
</code></pre></div>
<p>Here is an example of a CAST AI Agent deployment and secret with all the mentioned environment variables added:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Source: castai-agent/templates/deployment.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">castai-agent</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">castai-agent</span>
  <span class="nt">labels</span><span class="p">:</span>
    <span class="nt">app.kubernetes.io/name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">castai-agent</span>
    <span class="nt">app.kubernetes.io/instance</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">castai-agent</span>
    <span class="nt">app.kubernetes.io/version</span><span class="p">:</span> <span class="s">&quot;v0.23.0&quot;</span>
    <span class="nt">app.kubernetes.io/managed-by</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">castai</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">replicas</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
  <span class="nt">selector</span><span class="p">:</span>
    <span class="nt">matchLabels</span><span class="p">:</span>
      <span class="nt">app.kubernetes.io/name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">castai-agent</span>
      <span class="nt">app.kubernetes.io/instance</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">castai-agent</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">metadata</span><span class="p">:</span>
      <span class="nt">labels</span><span class="p">:</span>
        <span class="nt">app.kubernetes.io/name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">castai-agent</span>
        <span class="nt">app.kubernetes.io/instance</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">castai-agent</span>
    <span class="nt">spec</span><span class="p">:</span>
      <span class="nt">priorityClassName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">system-cluster-critical</span>
      <span class="nt">serviceAccountName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">castai-agent</span>
      <span class="nt">affinity</span><span class="p">:</span>
        <span class="nt">nodeAffinity</span><span class="p">:</span>
          <span class="nt">requiredDuringSchedulingIgnoredDuringExecution</span><span class="p">:</span>
            <span class="nt">nodeSelectorTerms</span><span class="p">:</span>
              <span class="p p-Indicator">-</span> <span class="nt">matchExpressions</span><span class="p">:</span>
                  <span class="p p-Indicator">-</span> <span class="nt">key</span><span class="p">:</span> <span class="s">&quot;kubernetes.io/os&quot;</span>
                    <span class="nt">operator</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">In</span>
                    <span class="nt">values</span><span class="p">:</span> <span class="p p-Indicator">[</span> <span class="s">&quot;linux&quot;</span> <span class="p p-Indicator">]</span>
              <span class="p p-Indicator">-</span> <span class="nt">matchExpressions</span><span class="p">:</span>
                  <span class="p p-Indicator">-</span> <span class="nt">key</span><span class="p">:</span> <span class="s">&quot;beta.kubernetes.io/os&quot;</span>
                    <span class="nt">operator</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">In</span>
                    <span class="nt">values</span><span class="p">:</span> <span class="p p-Indicator">[</span> <span class="s">&quot;linux&quot;</span> <span class="p p-Indicator">]</span>

      <span class="nt">containers</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">agent</span>
          <span class="nt">image</span><span class="p">:</span> <span class="s">&quot;us-docker.pkg.dev/castai-hub/library/agent:v0.24.0&quot;</span>
          <span class="nt">imagePullPolicy</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
          <span class="nt">env</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">API_URL</span>
              <span class="nt">value</span><span class="p">:</span> <span class="s">&quot;api.cast.ai&quot;</span>
            <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">PPROF_PORT</span>
              <span class="nt">value</span><span class="p">:</span> <span class="s">&quot;6060&quot;</span>
            <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">PROVIDER</span>
              <span class="nt">value</span><span class="p">:</span> <span class="s">&quot;eks&quot;</span>

            <span class="c1"># Provide values discovered via AWS EC2 Metadata endpoint:</span>
            <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">EKS_ACCOUNT_ID</span>
              <span class="nt">value</span><span class="p">:</span> <span class="s">&quot;000000000000&quot;</span>
            <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">EKS_REGION</span>
              <span class="nt">value</span><span class="p">:</span> <span class="s">&quot;eu-central-1&quot;</span>
            <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">EKS_CLUSTER_NAME</span>
              <span class="nt">value</span><span class="p">:</span> <span class="s">&quot;castai-example&quot;</span>

          <span class="nt">envFrom</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="nt">secretRef</span><span class="p">:</span>
                <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">castai-agent</span>
          <span class="nt">resources</span><span class="p">:</span>
            <span class="nt">requests</span><span class="p">:</span>
              <span class="nt">cpu</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">100m</span>
            <span class="nt">limits</span><span class="p">:</span>
              <span class="nt">cpu</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1000m</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">autoscaler</span>
          <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">k8s.gcr.io/cpvpa-amd64:v0.8.3</span>
          <span class="nt">command</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">/cpvpa</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--target=deployment/castai-agent</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--namespace=castai-agent</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--poll-period-seconds=300</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--config-file=/etc/config/castai-agent-autoscaler</span>
          <span class="nt">volumeMounts</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="nt">mountPath</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/config</span>
              <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">autoscaler-config</span>
      <span class="nt">volumes</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">autoscaler-config</span>
          <span class="nt">configMap</span><span class="p">:</span>
            <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">castai-agent-autoscaler</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># Source: castai-agent/templates/secret.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Secret</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">castai-agent</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">castai-agent</span>
  <span class="nt">labels</span><span class="p">:</span>
    <span class="nt">app.kubernetes.io/instance</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">castai-agent</span>
    <span class="nt">app.kubernetes.io/managed-by</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">castai</span>
    <span class="nt">app.kubernetes.io/name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">castai-agent</span>
    <span class="nt">app.kubernetes.io/version</span><span class="p">:</span> <span class="s">&quot;v0.23.0&quot;</span>
<span class="nt">data</span><span class="p">:</span>
  <span class="c1"># Keep API_KEY unchanged.</span>
  <span class="nt">API_KEY</span><span class="p">:</span> <span class="s">&quot;xxxxxxxxxxxxxxxxxxxx&quot;</span>
  <span class="c1"># Provide an AWS Access Key to enable read-only AWS EC2 API access:</span>
  <span class="nt">AWS_ACCESS_KEY_ID</span><span class="p">:</span> <span class="s">&quot;xxxxxxxxxxxxxxxxxxxx&quot;</span>
  <span class="nt">AWS_SECRET_ACCESS_KEY</span><span class="p">:</span> <span class="s">&quot;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&quot;</span>
</code></pre></div>
<p>Alternatively, if you are using <a href="https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.html">IAM roles for service accounts</a> instead of providing AWS credentials you can annotate castai-agent service account with your IAM role.</p>
<div class="highlight"><pre><span></span><code>kubectl annotate serviceaccount -n castai-agent castai-agent eks.amazonaws.com/role-arn<span class="o">=</span><span class="s2">&quot;arn:aws:iam::111122223333:role/iam-role-name&quot;</span>
</code></pre></div>
<h2 id="tls-handshake-timeout-issue">TLS handshake timeout issue<a class="headerlink" href="#tls-handshake-timeout-issue" title="Permanent link">&para;</a></h2>
<p>In some edge cases due to specific cluster network setup agent might fail with the following message in the agent container logs:</p>
<div class="highlight"><pre><span></span><code>time=&quot;2021-11-13T05:19:54Z&quot; level=fatal msg=&quot;agent failed: registering cluster: getting namespace \&quot;kube-system\&quot;: Get \&quot;https://100.10.1.0:443/api/v1/namespaces/kube-system\&quot;: net/http: TLS handshake timeout&quot; provider=eks version=v0.22.1
</code></pre></div>
<p>To resolve this issue delete <code>castai-agent</code> pod. The deployment will recreate the pod and issue will be resolved.</p>
<h2 id="refused-connection-to-control-plane">Refused connection to control plane<a class="headerlink" href="#refused-connection-to-control-plane" title="Permanent link">&para;</a></h2>
<p>When enabling cluster optimization for the first time, the user runs the pre-generated script to grant required permissions to CAST AI as shown below.</p>
<p><img alt="" src="enable-optimization.png" /></p>
<p>Error message <strong>No access to Kubernetes API server, please check your firewall settings</strong> indicates that a firewall prevents communication between the control plane and CAST AI.</p>
<p>To solve this issue, allow access to CAST AI IP <code>35.221.40.21</code> and then enable optimization again.</p>
<h2 id="disconnected-or-not-responding-cluster">Disconnected or Not responding cluster<a class="headerlink" href="#disconnected-or-not-responding-cluster" title="Permanent link">&para;</a></h2>
<p>If cluster has a <code>Not responding</code> status, most likely the CAST AI agent deployment is missing. Press <strong>Reconnect</strong> and follow the instructions provided.</p>
<p><img alt="" src="reconnect-cluster.png" /></p>
<p>The <code>Not responding</code> state is temporary and if not fixed, the cluster will enter into the <code>Disconnected</code> state. A disconnected cluster can be reconnected or deleted from the console as shown.</p>
<p><img alt="" src="disconnected-cluster.png" /></p>
<p>The delete action only removes the cluster from the CAST AI console, leaving it running in the cloud service provider.</p>
<h2 id="upgrading-the-agent">Upgrading the agent<a class="headerlink" href="#upgrading-the-agent" title="Permanent link">&para;</a></h2>
<p>To check which agent version is running on your cluster, run the following command:</p>
<div class="highlight"><pre><span></span><code>kubectl describe pod castai-agent -n castai-agent <span class="p">|</span> grep castai-hub/library/agent:v
</code></pre></div>
<p>You can cross-check our <a href="https://github.com/castai/k8s-agent">Github repository</a> for the number of the latest version available.</p>
<p>In order to upgrade the CAST AI agent version, please perform the following steps:</p>
<ol>
<li>Go to <a href="https://console.cast.ai/external-clusters/new">Connect cluster</a></li>
<li>Select the correct cloud service provider</li>
<li>Run the provided script</li>
</ol>
<p>In case of an error when upgrading the agent:</p>
<ul>
<li>i.e. <code>MatchExpressions:[]v1.LabelSelectorRequirement(nil)}: field is immutable</code><ul>
<li>run the following command: <code>kubectl delete deployment -n castai-agent castai-agent</code> and repeat the step 3.</li>
</ul>
</li>
</ul>
<p>The latest version of CAST AI agent is now deployed in your cluster.</p>
<h2 id="deleted-agent">Deleted agent<a class="headerlink" href="#deleted-agent" title="Permanent link">&para;</a></h2>
<p>In case CAST AI agent deployment got deleted from the cluster, you can re-install the agent by re-running the script from <a href="https://console.cast.ai/external-clusters/new"><strong>Connect cluster</strong></a> screen. Please ensure you have chosen the correct cloud service provider.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If you are still encountering any issues, ping us with logs output at:
  <a href="https://castai-community.slack.com/">https://castai-community.slack.com/</a></p>
</div>
<h2 id="cluster-controller-is-receiving-forbidden-access">Cluster-controller is receiving forbidden access<a class="headerlink" href="#cluster-controller-is-receiving-forbidden-access" title="Permanent link">&para;</a></h2>
<p>In some scenarios, during multiple onboardings, failing updates or other issues, cluster token that is used by cluster-controller, can get invalidated, and become forbidden from accessing CAST AI API, thus failing to operate the cluster. To renew it, the following Helm commands should be ran.</p>
<div class="highlight"><pre><span></span><code>helm repo update
helm upgrade -i cluster-controller castai-helm/castai-cluster-controller -n castai-agent <span class="se">\</span>
--set castai.apiKey<span class="o">=</span><span class="nv">$CASTAI_API_TOKEN</span> <span class="se">\</span>
--set castai.clusterID<span class="o">=</span>46d0d683-da70-4f69-b970-8d6509001c10
</code></pre></div>
<h2 id="aks-fail-to-pull-images-from-azure-container-registry-to-azure-kubernetes-service-cluster">AKS Fail to pull images from Azure Container Registry to Azure Kubernetes Service cluster<a class="headerlink" href="#aks-fail-to-pull-images-from-azure-container-registry-to-azure-kubernetes-service-cluster" title="Permanent link">&para;</a></h2>
<p>In case the cluster is already attached to an ACR, after onboarding on CAST AI, the Service Principal created to manage the cluster might not have the correct permissions to pull images from the private ACRs, resulting in <code>failed to pull and unpack image, failed to fetch oauth token: unexpected status: 401 Unauthorized</code> when new nodes are created.</p>
<p>Microsoft has a detailed documentation on how to troubleshoot and fix the issue <a href="https://learn.microsoft.com/en-us/troubleshoot/azure/azure-kubernetes/cannot-pull-image-from-acr-to-aks-cluster">Fail to pull images from Azure Container Registry to Azure Kubernetes Service cluster
</a>.</p>
<p>In most cases, <a href="https://learn.microsoft.com/en-us/troubleshoot/azure/azure-kubernetes/cannot-pull-image-from-acr-to-aks-cluster#solution-1-ensure-acrpull-role-assignment-is-created-for-identity">Solution 1: Ensure AcrPull role assignment is created for identity</a> is enough to resolve it.</p>

              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  <!-- Link to previous and/or next page -->
  
  <nav
          class="md-footer__inner md-grid"
          aria-label="Footer"
  >

    <!-- Link to previous page -->
    
    
    <a
            href="../../product-overview/security/"
            class="md-footer__link md-footer__link--prev"
            aria-label="Previous: Security Report"
            rel="prev"
    >
      <div class="md-footer__button md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </div>
      <div class="md-footer__title">
        <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
          Security Report
        </div>
      </div>
    </a>
    

    <!-- Link to next page -->
    
    
    <a
            href="../pod-placement/"
            class="md-footer__link md-footer__link--next"
            aria-label="Next: Pod placement"
            rel="next"
    >
      <div class="md-footer__title">
        <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
          Pod placement
        </div>
      </div>
      <div class="md-footer__button md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
      </div>
    </a>
    
  </nav>
  

  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-social">
  
</div>
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.indexes"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.0bbba5b5.min.js"}</script>
    
    
      <script src="../../assets/javascripts/bundle.649a939e.min.js"></script>
      
    
  </body>
</html>